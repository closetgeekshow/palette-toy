<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CSS Variable Doodling Lab</title>
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
  />
  <style>
    :root {
      --surface-base: #0b1220;
      --surface-raised: #121c30;
      --surface-glow: #1b2a46;
      --text-primary: #e5e7eb;
      --text-muted: #9ca3af;
      --accent-strong: #7c3aed;
      --accent-soft: #8b5cf6;
      --border-weak: rgba(148, 163, 184, 0.4);
      --shadow-raised: 0 12px 32px rgba(0, 0, 0, 0.24);
      --radius-sharp: 4px;
      --radius-soft: 14px;
      --radius-pill: 999px;
      --radius-active: var(--radius-soft);
      --font-body: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-heading: var(--font-body);
      --font-logo: var(--font-heading);
      --font-code: ui-monospace, "SFMono-Regular", Menlo, Consolas, monospace;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 16% -12%, rgba(124, 58, 237, 0.18), rgba(2, 6, 23, 0)),
        radial-gradient(circle at 82% 12%, rgba(14, 165, 233, 0.2), rgba(2, 6, 23, 0)),
        linear-gradient(180deg, #020617, #0b1220 38%, #0f172a 100%);
      color: var(--text-primary);
      font-family: var(--font-body);
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 20px;
      padding: 28px;
    }

    header {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px;
      border: 1px solid var(--border-weak);
      border-radius: var(--radius-active);
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.08), rgba(14, 165, 233, 0.05));
      box-shadow: var(--shadow-raised);
    }

    header h1 { margin: 0; font-size: 1.05rem; letter-spacing: 0.08em; text-transform: uppercase; }
    header p { margin: 0; color: var(--text-muted); font-size: 0.95rem; }

    .panel {
      background: var(--surface-raised);
      border: 1px solid var(--border-weak);
      border-radius: var(--radius-active);
      box-shadow: var(--shadow-raised);
      padding: 16px;
    }

    .stack { display: grid; gap: 14px; }
    .row { display: flex; gap: 10px; align-items: center; }
    .row label { font-size: 0.9rem; color: var(--text-muted); min-width: 118px; }
    .swatch {
      width: 32px;
      height: 32px;
      border-radius: 10px;
      border: 1px solid var(--border-weak);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    textarea {
      width: 100%;
      min-height: 140px;
      background: var(--surface-base);
      color: var(--text-primary);
      border: 1px solid var(--border-weak);
      border-radius: 12px;
      padding: 12px;
      font-family: var(--font-code);
      font-size: 0.9rem;
    }

    button,
    select,
    input[type="color"],
    input[type="range"] {
      background: var(--surface-base);
      color: var(--text-primary);
      border: 1px solid var(--border-weak);
      border-radius: 10px;
      padding: 8px 12px;
      font-family: var(--font-body);
    }

    button:hover { border-color: var(--accent-soft); cursor: pointer; }

    .pill-row { display: flex; gap: 8px; flex-wrap: wrap; }

    .preview {
      background: var(--surface-base);
      border: 1px solid var(--border-weak);
      border-radius: var(--radius-active);
      padding: 20px;
      min-height: 300px;
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .card {
      background: linear-gradient(160deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.01));
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-active);
      padding: 16px;
      box-shadow: 0 18px 38px rgba(0, 0, 0, 0.22);
      display: grid;
      gap: 10px;
    }

    .card h3 { margin: 0; font-family: var(--font-heading); font-size: 1rem; letter-spacing: 0.04em; }
    .card p { margin: 0; color: var(--text-muted); }
    .badge { padding: 6px 10px; border-radius: 20px; border: 1px solid var(--accent-soft); background: rgba(124, 58, 237, 0.08); }

    .controls { display: grid; gap: 18px; }

    .prompt { background: var(--surface-base); border: 1px dashed var(--border-weak); border-radius: 14px; padding: 14px; }
    .prompt pre { margin: 0; white-space: pre-wrap; color: var(--text-muted); font-family: var(--font-code); }

    .status { font-size: 0.9rem; color: var(--text-muted); }
    .status strong { color: #fbbf24; }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>CSS Variable Doodling Lab</h1>
      <p>Freehand tokens with live previews, contrast guardrails, and sharable prompts.</p>
    </div>
    <div class="pill-row" aria-label="radius presets">
      <button data-radius="--radius-sharp" aria-pressed="false">Sharp</button>
      <button data-radius="--radius-soft" aria-pressed="true">Soft</button>
      <button data-radius="--radius-pill" aria-pressed="false">Pill</button>
    </div>
  </header>

  <section class="panel controls" aria-label="token controls" data-role="tokens">
    <div class="stack">
      <div class="row" data-token="accent.strong">
        <label>Accent strong</label>
        <input type="color" value="#7c3aed" data-bind="--accent-strong" aria-label="Accent strong" />
        <div class="swatch" style="background: var(--accent-strong)"></div>
      </div>
      <div class="row" data-token="accent.soft">
        <label>Accent soft</label>
        <input type="color" value="#8b5cf6" data-bind="--accent-soft" aria-label="Accent soft" />
        <div class="swatch" style="background: var(--accent-soft)"></div>
      </div>
      <div class="row" data-token="surface.base">
        <label>Surface base</label>
        <input type="color" value="#0b1220" data-bind="--surface-base" aria-label="Surface base" />
        <div class="swatch" style="background: var(--surface-base)"></div>
      </div>
      <div class="row" data-token="text.primary">
        <label>Text primary</label>
        <input type="color" value="#e5e7eb" data-bind="--text-primary" aria-label="Text primary" />
        <div class="swatch" style="background: var(--text-primary)"></div>
      </div>
      <div class="row" data-token="radius.active">
        <label>Radius</label>
        <input type="range" min="4" max="24" step="1" value="14" data-bind="--radius-active" aria-label="Radius slider" />
        <span class="status" data-preview="radius">14px</span>
      </div>
    </div>

    <div class="stack" aria-label="doodle pad">
      <label for="doodle">Doodle tokens (one per line: token: value)</label>
      <textarea id="doodle" spellcheck="false" aria-label="Doodle tokens">
accent.strong: #7c3aed
surface.base: #0b1220
text.primary: #e5e7eb
radius.active: 14px
font.body: Inter, system-ui, sans-serif
      </textarea>
      <div class="pill-row">
        <button id="apply-doodle">Apply doodle</button>
        <button id="share-doodle">Copy current token JSON</button>
      </div>
    </div>

    <div class="prompt" aria-label="prompt helper">
      <strong>Prompt scaffold</strong>
      <pre id="prompt-text"></pre>
    </div>

    <div class="status" id="contrast-status" aria-live="polite"></div>
  </section>

  <section class="panel" aria-label="preview" data-role="preview">
    <div class="preview">
      <article class="card" data-token="surface.raised">
        <div class="badge" data-token="accent.soft">Live Tokens</div>
        <h3 data-token="text.primary">LLM-Friendly Doodle</h3>
        <p data-token="text.muted">Adjust variables above; all components read from CSS tokens so visibility stays reliable.</p>
      </article>
      <article class="card" data-token="surface.raised">
        <div class="badge" data-token="accent.soft">Radius</div>
        <h3>Sharp vs pill</h3>
        <p>Use the pill buttons or slider to feel how radii propagate through cards, badges, and controls.</p>
      </article>
      <article class="card" data-token="surface.raised">
        <div class="badge" data-token="accent.soft">Fonts</div>
        <h3 style="font-family: var(--font-heading)">Fallback-aware type</h3>
        <p>The heading font falls back to the body font; logos fall back to headings, code falls back to monospace.</p>
      </article>
    </div>
  </section>

  <script>
    const doodleArea = document.getElementById('doodle');
    const applyBtn = document.getElementById('apply-doodle');
    const shareBtn = document.getElementById('share-doodle');
    const contrastStatus = document.getElementById('contrast-status');
    const promptText = document.getElementById('prompt-text');
    const radiusPreview = document.querySelector('[data-preview="radius"]');

    const promptTemplate = `THEME IDEAS: (fill manually; no auto-generation)\n\nRequired tokens: --font-body, --surface-base, --text-primary.\nOptional tokens: --font-heading (falls back to body), --font-logo (falls back to heading), --font-code (safe monospace fallback), --accent-strong, --accent-soft, --radius-active (defaults to 14px), --surface-raised, --surface-glow.\nRules: keep objects readable on surfaces (aim for contrast >= 4.5), load Google Fonts via imports array of CSS v2 segments, and prefer semantic names like surface.base, accent.strong.`;

    promptText.textContent = promptTemplate;

    const bindings = Array.from(document.querySelectorAll('[data-bind]'));
    bindings.forEach((input) => {
      const token = input.dataset.bind;
      input.addEventListener('input', () => {
        const value = input.type === 'range' ? `${input.value}px` : input.value;
        document.documentElement.style.setProperty(token, value);
        if (token === '--radius-active' && radiusPreview) radiusPreview.textContent = value;
        syncDoodleFromStyles();
        checkContrast();
      });
    });

    document.querySelectorAll('button[data-radius]').forEach((button) => {
      button.addEventListener('click', () => {
        const token = button.dataset.radius;
        const value = getComputedStyle(document.documentElement).getPropertyValue(token) || '14px';
        document.documentElement.style.setProperty('--radius-active', value.trim());
        bindings
          .filter((node) => node.dataset.bind === '--radius-active')
          .forEach((slider) => {
            slider.value = parseInt(value, 10);
            radiusPreview.textContent = `${slider.value}px`;
          });
        document.querySelectorAll('button[data-radius]').forEach((btn) => btn.setAttribute('aria-pressed', 'false'));
        button.setAttribute('aria-pressed', 'true');
        syncDoodleFromStyles();
      });
    });

    function applyDoodle() {
      const lines = doodleArea.value.split(/\n+/).map((l) => l.trim()).filter(Boolean);
      lines.forEach((line) => {
        const [rawKey, ...rest] = line.split(':');
        if (!rawKey || rest.length === 0) return;
        const key = rawKey.trim();
        const value = rest.join(':').trim();
        const cssVar = key.startsWith('--') ? key : `--${key.replace(/\./g, '-')}`;
        document.documentElement.style.setProperty(cssVar, value);
        const matching = bindings.find((el) => el.dataset.bind === cssVar);
        if (matching) {
          if (matching.type === 'color') matching.value = value;
          if (matching.type === 'range') {
            matching.value = parseInt(value, 10) || matching.value;
            radiusPreview.textContent = `${matching.value}px`;
          }
        }
      });
      checkContrast();
    }

    function syncDoodleFromStyles() {
      const tokens = ['--accent-strong', '--accent-soft', '--surface-base', '--text-primary', '--radius-active', '--font-body'];
      const lines = tokens
        .map((token) => {
          const cleanKey = token.replace(/^--/, '').replace(/-/g, '.');
          const value = getComputedStyle(document.documentElement).getPropertyValue(token).trim();
          return `${cleanKey}: ${value}`;
        })
        .join('\n');
      doodleArea.value = lines;
    }

    function checkContrast() {
      const base = getComputedStyle(document.documentElement).getPropertyValue('--surface-base');
      const text = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
      const ratio = contrast(hex(base), hex(text));
      const visible = ratio >= 4.5;
      contrastStatus.innerHTML = visible
        ? `Contrast OK: ${ratio.toFixed(2)} (objects stay visible)`
        : `<strong>Low contrast:</strong> ${ratio.toFixed(2)} â€” raise text or surface contrast.`;
    }

    function hex(str) {
      const match = str.trim().match(/^#([0-9a-f]{6}|[0-9a-f]{3})/i);
      if (!match) return { r: 255, g: 255, b: 255 };
      const hex = match[1];
      if (hex.length === 3) return { r: parseInt(hex[0] + hex[0], 16), g: parseInt(hex[1] + hex[1], 16), b: parseInt(hex[2] + hex[2], 16) };
      return { r: parseInt(hex.slice(0, 2), 16), g: parseInt(hex.slice(2, 4), 16), b: parseInt(hex.slice(4, 6), 16) };
    }

    function contrast(bg, fg) {
      const l1 = luminance(bg.r, bg.g, bg.b);
      const l2 = luminance(fg.r, fg.g, fg.b);
      const brightest = Math.max(l1, l2);
      const darkest = Math.min(l1, l2);
      return (brightest + 0.05) / (darkest + 0.05);
    }

    function luminance(r, g, b) {
      const srgb = [r, g, b].map((v) => {
        const channel = v / 255;
        return channel <= 0.03928 ? channel / 12.92 : Math.pow((channel + 0.055) / 1.055, 2.4);
      });
      return 0.2126 * srgb[0] + 0.7152 * srgb[1] + 0.0722 * srgb[2];
    }

    applyBtn.addEventListener('click', applyDoodle);
    shareBtn.addEventListener('click', () => {
      const tokens = Array.from(document.styleSheets)
        .flatMap((sheet) => Array.from(sheet.cssRules || []))
        .filter((rule) => rule.selectorText === ':root')
        .flatMap((rule) => Array.from(rule.style))
        .filter((name) => name.startsWith('--'))
        .reduce((acc, name) => {
          acc[name] = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
          return acc;
        }, {});
      const json = JSON.stringify(tokens, null, 2);
      navigator.clipboard?.writeText(json);
      shareBtn.textContent = 'Copied!';
      setTimeout(() => (shareBtn.textContent = 'Copy current token JSON'), 1400);
    });

    syncDoodleFromStyles();
    checkContrast();
  </script>
</body>
</html>
